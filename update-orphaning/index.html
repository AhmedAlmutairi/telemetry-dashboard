<!DOCTYPE html>
<html>
<head>
<title>Application Update Out Of Date Dashboard</title>
<meta charset="utf-8">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="https://telemetry.mozilla.org/new-pipeline/lib/d3pie.min.js"></script>
<style>
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
#mainDiv {
  position: relative;
  width: 960px;
  margin: 1em auto 4em;
}
#weeklyDropdownDiv {
  border-radius: 5px;
  border: 2px solid #aaa;
  background-color: #f0f0f2;
  padding: 7px;
  z-index: 10;
  position: fixed;
}
#weeklyDropdown {
  text-align: center;
  width: 100%;
}
.p0_title,
.p1_title,
.p2_title,
.p3_title {
  font-weight: bold;
}
.sectionHeader {
  font-family: Arial;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  margin-top: 30px;
}
.sectionSubheader {
  font-family: Arial;
  font-size: .9em;
  font-weight: bold;
  text-align: center;
  margin-top: 2px;
}
.sectionHover {
  margin-top: 8px;
  font-family: Arial;
  font-size: 14px;
  text-align: center;
  color: #999999;
}
select {
  font-size: .9em;
}
table {
  border-radius: 5px;
  border: 2px solid #aaa;
  border-collapse: separate;
  border-spacing: 0;
}
td {
  vertical-align: top;
  padding: 2px 3px;
}
tbody tr:nth-child(odd) {
  background: #f0f0f2;
}
td:nth-child(1),
td:nth-child(2) {
  font-weight: bold;
  text-align: right;
}
td:nth-child(3) {
  width: 100%;
}
tr:nth-child(1) td {
  padding-top: .3em;
}
tr:last-child td {
  padding-bottom: .3em;
}
td:nth-child(1) {
  padding-left: .3em;
}
td:nth-child(3) {
  padding-right: .3em;
}
.axis text {
  font-family: sans-serif;
  font-size: .9em;
}
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
.x.axis path {
  display: none;
}
.pieChart {
  height: 500px;
  margin-top: 20px;
}
#outOfDateDesc {
  margin-top: 20px;
}
#notMinReqsDesc {
  margin-bottom: 20px;
}
.barChartDetails {
  font-size: .9em;
  height: 4em;
  border-radius: 5px;
  border: 2px solid #aaa;
  background-color: #f0f0f2;
  padding: .3em;
  margin-bottom: 10px;
}
.barChartDesc {
  height: 2em;
}
.barChartLink {
  font-size: .9em;
  height: 2em;
  padding-top: 12px;
  text-align: left;
}
.goodBar,
.okBar,
.badBar {
  fill-opacity: .8;
}
.goodBar:hover,
.okBar:hover,
.badBar:hover {
  fill-opacity: 1;
}
.goodBar {
  fill: #92B600;
}
.okBar {
  fill: #0065d1;
}
.badBar {
  fill: #d10000;
}
</style>
</head>
<body>
<div id="weeklyDropdownDiv">
Report Week:&nbsp;&nbsp;<br/>
<select id="weeklyDropdown" onchange="populateDashboard()"><option>--/--/----</option></select>
</div>
<div id="mainDiv">
<h1>Application Update Out Of Date Dashboard</h1>
<div><p>The data below is from the Telemetry longitudinal data source which contains approximately 1% of all Telemetry clients for each Firefox version. The period for the report is the 7 days prior to the Report Week date. The old dashboard can be found <a href="index-old.html">here</a>.</p>
</div>

<div id="summaryDistChart" class="pieChart"></div>
<table id="summaryDistDetails"></table>
<div id="outOfDateDesc"></div>
<div id="notMinReqsChart" class="pieChart"></div>
<div id="notMinReqsDesc">Clients are considered <b>out of date, potentially of concern</b> when they are out of date and haven't met the minimum requirements
for there to be an expectation that the client should have updated. Since each criteria can match multiple clients the order that they are applied affects the
percentage of clients that match each criteria. The order that the criteria are applied is the same order as they are listed below.</div>
<table id="notMinReqsDetails"></table>
<div id="ofConcernChart" class="pieChart"></div>
<table id="ofConcernDetails"></table>
<div id="VersionDistChart" class="pieChart"></div>
<div class="sectionHeader">Out of date, of concern client last update check code (check phase)</div>
<div class="sectionHover">(hover over a bar for details below the chart)</div>
<div><label><input id="checkCodeSortInput" class="sortCheckbox" type="checkbox"> Sort values</label></div>
<div class="barChart"><svg id="checkCodeChart"></svg></div>
<div class="barChartDetails">
<div id="checkCodeDetails" class="barChartDesc"></div>
<div id="checkCodeLink" class="barChartLink"></div>
</div>
<div class="sectionHeader">Out of date, of concern client last update check extended error code (check phase)</div>
<div class="sectionSubheader">Breakdown of codes 22 and 23 from the previous chart</div>
<div class="sectionHover">(hover over a bar for details below the chart)</div>
<div><label><input id="checkExErrorSortInput" class="sortCheckbox" type="checkbox"> Sort values</label></div>
<div class="barChart"><svg id="checkExErrorChart"></svg></div>
<div class="barChartDetails">
<div id="checkExErrorDetails" class="barChartDesc"></div>
<div id="checkExErrorLink" class="barChartLink"></div>
</div>
<div class="sectionHeader">Out of date, of concern client last update download code (download phase)</div>
<div class="sectionHover">(hover over a bar for details below the chart)</div>
<div><label><input id="downloadCodeSortInput" class="sortCheckbox" type="checkbox"> Sort values</label></div>
<div class="barChart"><svg id="downloadCodeChart"></svg></div>
<div class="barChartDetails">
<div id="downloadCodeDetails" class="barChartDesc"></div>
<div id="downloadCodeLink" class="barChartLink"></div>
</div>
<div class="sectionHeader">Out of date, of concern client update staging state code (stage phase)</div>
<div class="sectionHover">(hover over a bar for details below the chart)</div>
<div><label><input id="stateCodeStageSortInput" class="sortCheckbox" type="checkbox"> Sort values</label></div>
<div class="barChart"><svg id="stateCodeStageChart"></svg></div>
<div class="barChartDetails">
<div id="stateCodeStageDetails" class="barChartDesc"></div>
<div id="stateCodeStageLink" class="barChartLink"></div>
</div>
<div class="sectionHeader">Out of date, of concern client update staging failure code (stage phase)</div>
<div class="sectionSubheader">Breakdown of code 12 from the previous chart</div>
<div class="sectionHover">(hover over a bar for details below the chart)</div>
<div><label><input id="stateFailureCodeStageSortInput" class="sortCheckbox" type="checkbox"> Sort values</label></div>
<div class="barChart"><svg id="stateFailureCodeStageChart"></svg></div>
<div class="barChartDetails">
<div id="stateFailureCodeStageDetails" class="barChartDesc"></div>
<div id="stateFailureCodeStageLink" class="barChartLink"></div>
</div>
<div class="sectionHeader">Out of date, of concern client update startup state code (apply phase)</div>
<div class="sectionHover">(hover over a bar for details below the chart)</div>
<div><label><input id="stateCodeStartupSortInput" class="sortCheckbox" type="checkbox"> Sort values</label></div>
<div class="barChart"><svg id="stateCodeStartupChart"></svg></div>
<div class="barChartDetails">
<div id="stateCodeStartupDetails" class="barChartDesc"></div>
<div id="stateCodeStartupLink" class="barChartLink"></div>
</div>
<div class="sectionHeader">Out of date, of concern client update startup failure code (apply phase)</div>
<div class="sectionSubheader">Breakdown of code 12 from the previous chart</div>
<div class="sectionHover">(hover over a bar for details below the chart)</div>
<div><label><input id="stateFailureCodeStartupSortInput" class="sortCheckbox" type="checkbox"> Sort values</label></div>
<div class="barChart"><svg id="stateFailureCodeStartupChart"></svg></div>
<div class="barChartDetails">
<div id="stateFailureCodeStartupDetails" class="barChartDesc"></div>
<div id="stateFailureCodeStartupLink" class="barChartLink"></div>
</div>

<br/>
<hr>
This dashboard is maintained by <a href="mailto:rstrong@mozilla.com">:rstrong</a>.<br/>
The Spark Notebook for the weekly reports is scheduled to run every Sunday and can be found <a href="https://github.com/mozilla-services/data-pipeline/tree/master/reports/update-orphaning/Update orphaning analysis using longitudinal dataset.ipynb">here</a>.<br/>
This web page can be found <a href="https://github.com/mozilla/telemetry-dashboard/blob/gh-pages/update-orphaning/index.html">here</a>.
</div>
<script>
  var dataUrl = "https://s3-us-west-2.amazonaws.com/telemetry-public-analysis-2/data/rstrong@mozilla.com/UpdateOutOfDate/";

  var bcTransDur = 800;
  var bcMargin = {top: 20, right: 20, bottom: 30, left: 40};
  var bottomOffset = 60;
  var bcWidth = 960 - bcMargin.left - bcMargin.right;
  var bcHeight = 500 - bcMargin.top - bcMargin.bottom;
  var formatPercent = d3.format(".0%");

  function getBarData(aData) {
    var outData = [];
    var outDataTotal = 0;
    for (key in aData) {
      var code = parseInt(key, 10);
      var val = parseInt(aData[code], 10);
      outData.push({index: code, value: val});
      outDataTotal += val;
    }

    outData.forEach(function(d) {
      d.value = 1 / outDataTotal * d.value;
    });
    return [outData, outDataTotal];
  }

  function getSortedData(aData, aSectionPrefix) {
    return aData.sort(document.getElementById(aSectionPrefix + "SortInput").checked
               ? function(a, b) { var val = b.value - a.value; if (val) { return val; } return d3.ascending(a.index, b.index); }
               : function(a, b) { return d3.ascending(a.index, b.index); })
             .map(function(d) { return d.index; });
  }

  function updateBarChart(aData, aSectionPrefix, aBarClassFn, aX, aY, aXAxis, aYAxis, aJSONData, aDesc1, aDesc2, aSrchOpt) {
    var svg = d3.select("#" + aSectionPrefix + "Chart");
    var bars = svg.selectAll("rect." + aSectionPrefix).data(aData, function(d) { return d.index; });
    var transition = svg.transition().duration(bcTransDur);

    var x = aX.domain(getSortedData(aData, aSectionPrefix)).copy();
    var y = aY.domain([0, d3.max(aData, function(d) { return d.value; })]).copy();

    transition.select("g.x.axis." + aSectionPrefix + "Axis")
      .call(aXAxis)
      .selectAll("g")
      .selectAll("text")
        .each("start", function() {
          if (aSectionPrefix == "checkExError") {
            // This chart needs its x axis text rotated and repositioned before animating
            svg.select("g.x.axis." + aSectionPrefix + "Axis")
              .selectAll("g")
              .selectAll("text")
              .style("text-anchor", "end")
              .attr("dy", "-.3em")
              .attr("dx", "-.6em")
              .attr("transform", "rotate(-90)");
          }
        });

    transition.select("g.y.axis." + aSectionPrefix + "Axis").call(aYAxis);

    bars.enter()
      .append("rect")
      .attr("x", function(d) { return x(d.index); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return bcHeight; })
      .attr("height", 0)
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")")
      .attr("class", aBarClassFn);

    bars.exit()
      .transition()
      .duration(bcTransDur)
      .attr("y", y(0))
      .attr("height", bcHeight - y(0)).style('fill-opacity', 1e-6)
      .remove();

    bars.transition()
      .duration(bcTransDur)
      .attr("x", function(d) { return x(d.index); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.value); })
      .attr("height", function(d) { return bcHeight - y(d.value); });

    bars.on("mouseover", function(d) {
      return displayBarDetails(aSectionPrefix, d.index, aData, aJSONData, aDesc1, aDesc2, aSrchOpt);
    });

    svg.select("g.x.axis." + aSectionPrefix + "Axis")
      .selectAll(".tick")
      .on("mouseover", function(d) {
        return displayBarDetails(aSectionPrefix, d, aData, aJSONData, aDesc1, aDesc2, aSrchOpt);
      });
  }

  function barChartSortChange(aData, aSectionPrefix, aX, aXAxis) {
    var svg = d3.select("#" + aSectionPrefix + "Chart");
    var transition = svg.transition().duration(bcTransDur);

    var x = aX.domain(getSortedData(aData, aSectionPrefix)).copy();

    svg.selectAll("rect." + aSectionPrefix)
      .sort(function(a, b) { return x(a.index) - x(b.index); });

    transition.selectAll("rect." + aSectionPrefix)
      .attr("x", function(d) { return x(d.index); });

    transition.select("g.x.axis." + aSectionPrefix + "Axis")
      .call(aXAxis)
      .selectAll("g")
      .selectAll("text")
        .each("start", function() {
          if (aSectionPrefix == "checkExError") {
            // This chart needs its x axis text rotated and repositioned before animating
            svg.select("g.x.axis." + aSectionPrefix + "Axis")
              .selectAll("g")
              .selectAll("text")
              .style("text-anchor", "end")
              .attr("dy", "-.3em")
              .attr("dx", "-.6em")
              .attr("transform", "rotate(-90)");
          }
        });

  }

  const checkCodeGeneralDetails = {
    "0": {code: "CHK_NO_UPDATE_FOUND", desc: "No update was found during the update check (no notification is shown)."},
    "1": {code: "CHK_ADDON_NO_INCOMPAT", desc: "No incompatible add-ons were found during the incompatible add-ons check, proceed with the download of the update (no notification is shown)."},
    "2": {code: "CHK_SHOWPROMPT_SNIPPET", desc: "The update.xml specified that a prompt should be shown (an update notification is shown)."},
    "3": {code: "CHK_SHOWPROMPT_PREF", desc: "Preferences specified that a prompt should be shown (an update notification is shown)."},
    "4": {code: "CHK_ADDON_PREF_DISABLED", desc: "Preferences disabled the incompatible add-on check (the update is downloaded in the background)."},
    "5": {code: "CHK_ADDON_SAME_APP_VER", desc: "The incompatible add-on check was not performed because the current app version was the same as the app version of the update (the update is downloaded in the background)."},
    "6": {code: "CHK_ADDON_UPDATES_FOR_INCOMPAT", desc: "Incompatible add-ons have been detected and all of them have updates available (the update is downloaded in the background)."},
    "7": {code: "CHK_ADDON_HAVE_INCOMPAT", desc: "Incompatible add-ons have been detected (an update notification is shown)."},
    "8": {code: "CHK_HAS_ACTIVEUPDATE", desc: "An active update is already in progress (no notification is shown)."},
    "9": {code: "CHK_IS_DOWNLOADING", desc: "A background download is already in progress (no notification is shown)."},
    "10": {code: "CHK_IS_STAGED", desc: "An update is already staged (no notification is shown)."},
    "11": {code: "CHK_IS_DOWNLOADED", desc: "An update is already downloaded (no notification is shown)."},
    "12": {code: "CHK_PREF_DISABLED", desc: "Preferences have disabled background update checks (no notification is shown)."},
    "13": {code: "CHK_ADMIN_DISABLED", desc: "Update checks are disabled by administrative locked preferences (no notification is shown)."},
    "14": {code: "CHK_NO_MUTEX", desc: "An update check couldn't be performed because of a lack of a mutex per hasUpdateMutex() (no notification is shown)."},
    "15": {code: "CHK_UNABLE_TO_CHECK", desc: "An update check couldn't be performed per gCanCheckForUpdates (no notification is shown). This should be covered by other codes and is recorded just in case."},
    "16": {code: "CHK_DISABLED_FOR_SESSION", desc: "Background update checks were disabled for the current session (no notification is shown)."},
    "17": {code: "CHK_OFFLINE", desc: "An update check couldn't be performed while offline (no notification is shown)."},
    "18": {code: "CHK_CERT_ATTR_NO_UPDATE_PROMPT", desc: "A certificate check (with no update available) failed and the retry threshold was reached (an update notification is shown). This code may indicate an attempted MITM attack."},
    "19": {code: "CHK_CERT_ATTR_NO_UPDATE_SILENT", desc: "A certificate check (with no update available) failed, but the retry threshold was not yet reached (no notification is shown). This code may indicate an attempted MITM attack."},
    "20": {code: "CHK_CERT_ATTR_WITH_UPDATE_PROMPT", desc: "A certificate check (with an update available) failed and the retry threshold was reached (an update notification is shown). This code may indicate an attempted MITM attack."},
    "21": {code: "CHK_CERT_ATTR_WITH_UPDATE_SILENT", desc: "A certificate check (with an update available) failed, but the retry threshold was not yet reached (no notification is shown). This code may indicate an attempted MITM attack."},
    "22": {code: "CHK_GENERAL_ERROR_PROMPT", desc: "A general update failure occurred and the retry threshold was reached (an update notification is shown)."},
    "23": {code: "CHK_GENERAL_ERROR_SILENT", desc: "A general update failure occurred, but the retry threshold was not yet reached (no notification is shown)."},
    "24": {code: "CHK_NO_COMPAT_UPDATE_FOUND", desc: "Even though updates were available, no compatible update was found (no notification is shown)."},
    "25": {code: "CHK_UPDATE_PREVIOUS_VERSION", desc: "An update for a previous version was found (no notification is shown)."},
    "26": {code: "CHK_UPDATE_NEVER_PREF", desc: "An update was found for which the \"never\" preference was set to never install (no notification is shown)."},
    "27": {code: "CHK_UPDATE_INVALID_TYPE", desc: "An update was found without a type attribute (no notification is shown)."},
    "28": {code: "CHK_UNSUPPORTED", desc: "The system is no longer supported (a \"system is unsupported\" notification is shown)."},
    "29": {code: "CHK_UNABLE_TO_APPLY", desc: "An update could not be applied (a \"failure to apply\" notification is shown with manual installation instructions)."},
    "30": {code: "CHK_NO_OS_VERSION", desc: "An update check could not be performed due to a lack of OS information (no notification is shown)."},
    "31": {code: "CHK_NO_OS_ABI", desc: "An update check could not be performed due to a lack of OS ABI information (no notification is shown)."},
    "32": {code: "CHK_INVALID_DEFAULT_URL", desc: "An invalid URL was specified for the app.update.url default preference (no notification is shown)."},
    "33": {code: "CHK_INVALID_USER_OVERRIDE_URL", desc: "An invalid URL was specified for the app.update.url user preference (no notification is shown)."},
    "34": {code: "CHK_INVALID_DEFAULT_OVERRIDE_URL", desc: "An invalid URL was specified for the app.update.url.override user preference (no notification is shown)."},
    "35": {code: "CHK_ELEVATION_DISABLED_FOR_VERSION", desc: "The threshold for update elevation failures and cancelations was reached for a particular version of an update (Mac OS X Only) (no notification is shown)."},
    "36": {code: "CHK_ELEVATION_OPTOUT_FOR_VERSION", desc: "The user opted out of an elevated update for a particular version of an update (Mac OS X Only) (no notification is shown)."}};

  const checkExErrorGeneralDetails = {
    "200": {code: "OK", desc: "The request returned OK but failed in some other manner (e.g. invalid update.xml)."},
    "400": {code: "Bad Request", desc: "The request could not be understood by the server due to malformed syntax."},
    "401": {code: "Unauthorized", desc: "The request requires user authentication."},
    "402": {code: "Payment Required", desc: "This code is reserved for future use."},
    "403": {code: "Forbidden", desc: "The server understood the request, but is refusing to fulfill it."},
    "404": {code: "Not Found", desc: "The server has not found anything matching the Request-URI."},
    "405": {code: "Method Not Allowed", desc: "The method specified in the Request-Line is not allowed for the resource identified by the Request-URI."},
    "406": {code: "Not Acceptable", desc: "The resource identified by the request is only capable of generating response entities which have content characteristics not acceptable according to the accept headers sent in the request."},
    "407": {code: "Proxy Authentication Required", desc: "This code is similar to 401 (Unauthorized), but indicates that the client must first authenticate itself with the proxy."},
    "408": {code: "Request Timeout", desc: "The client did not produce a request within the time that the server was prepared to wait."},
    "409": {code: "Conflict", desc: "The request could not be completed due to a conflict with the current state of the resource."},
    "410": {code: "Gone", desc: "The requested resource is no longer available at the server and no forwarding address is known."},
    "500": {code: "Internal Server Error", desc: "The server encountered an unexpected condition which prevented it from fulfilling the request."},
    "501": {code: "Not Implemented", desc: "The server does not support the functionality required to fulfill the request."},
    "502": {code: "Bad Gateway", desc: "The server, while acting as a gateway or proxy, received an invalid response from the upstream server it accessed in attempting to fulfill the request."},
    "503": {code: "Service Unavailable", desc: "The server is currently unable to handle the request due to a temporary overloading or maintenance of the server."},
    "504": {code: "Gateway Timeout", desc:"The server, while acting as a gateway or proxy, did not receive a timely response from the upstream server specified by the URI or some other auxiliary server"},
    "505": {code: "HTTP Version Not Supported", desc: "The server does not support, or refuses to support, the HTTP protocol version that was used in the request message."},
    "2147500036": {code: "NS_ERROR_ABORT", desc: "This error indicates that an operation failed and the caller should abort whatever action is being performed. This typically will occur if an operation could not complete properly."},
    "2147500037": {code: "NS_ERROR_FAILURE", desc: "This is the most general of all the errors and occurs for all errors for which a more specific error code does not apply."},
    "2147746065": {code: "NS_ERROR_NOT_AVAILABLE", desc: "An operation could not be completed because some other necessary component or resource was not available."},
    "2147942414": {code: "NS_ERROR_OUT_OF_MEMORY", desc: "This error occurs when there is not enough memory available to carry out an operation, or an error occurred trying to allocate memory."},
    "2152398850": {code: "NS_BINDING_ABORTED", desc: "The async request failed because it was aborted by some user action."},
    "2152398861": {code: "NS_ERROR_CONNECTION_REFUSED", desc: "The connection was refused."},
    "2152398862": {code: "NS_ERROR_NET_TIMEOUT", desc: "The connection has timed out."},
    "2152398868": {code: "NS_ERROR_NET_RESET", desc: "The connection was established, but no data was ever received."},
    "2152398878": {code: "NS_ERROR_UNKNOWN_HOST", desc: "The lookup of the hostname failed. <a href='https://bugzilla.mozilla.org/show_bug.cgi?id=1224955'>Bug 1224955</a> provides an example of what can cause this."},
    "2152398890": {code: "NS_ERROR_UNKNOWN_PROXY_HOST", desc: "The lookup of the proxy hostname failed."},
    "2152398900": {code: "NS_ERROR_SOCKET_CREATE_FAILED", desc: "The specified socket type could not be created."},
    "2152398919": {code: "NS_ERROR_NET_INTERRUPT", desc: "The connection was established, but the data transfer was interrupted."},
    "2152398920": {code: "NS_ERROR_PROXY_CONNECTION_REFUSED", desc: "The connection to the proxy server was refused."},
    "2152398924": {code: "NS_ERROR_NET_PARTIAL_TRANSFER", desc: "A transfer was only partially done when it completed."},
    "2153389904": {code: "Unknown Security Failure", desc: "unknown"},
    "2153389942": {code: "SEC_ERROR_REUSED_ISSUER_AND_SERIAL", desc: "You are attempting to import a cert with the same issuer/serial as an existing cert, but that is not the same cert."},
    "2153389948": {code: "SEC_ERROR_OCSP_OLD_RESPONSE", desc: "The OCSP response contains out-of-date information."},
    "2153389949": {code: "SEC_ERROR_OCSP_FUTURE_RESPONSE", desc: "The OCSP response is not yet valid (contains a date in the future)."},
    "2153390044": {code: "SEC_ERROR_CA_CERT_INVALID", desc: "Issuer certificate is invalid."},
    "2153390050": {code: "SEC_ERROR_EXPIRED_ISSUER_CERTIFICATE", desc: "The certificate issuer's certificate has expired. Check your system date and time."},
    "2153390060": {code: "SEC_ERROR_UNTRUSTED_ISSUER", desc: "Peer's certificate issuer has been marked as not trusted by the user."},
    "2153390067": {code: "SEC_ERROR_UNKNOWN_ISSUER", desc: "Peer's Certificate issuer is not recognized."},
    "2153390070": {code: "SEC_ERROR_BAD_SIGNATURE", desc: "Peer's certificate has an invalid signature."},
    "2153390075": {code: "SEC_ERROR_INVALID_ARGS", desc: "security library: invalid arguments."},
    "2153390079": {code: "SEC_ERROR_LIBRARY_FAILURE", desc: "security library failure."},
    "2153394044": {code: "SSL_ERROR_PROTOCOL_VERSION_ALERT", desc: "Peer reports incompatible or unsupported protocol version."},
    "2153394061": {code: "SSL_ERROR_WEAK_SERVER_EPHEMERAL_DH_KEY", desc: "SSL received a weak ephemeral Diffie-Hellman key in Server Key Exchange handshake message."},
    "2153394076": {code: "SSL_ERROR_INTERNAL_ERROR_ALERT", desc: "Peer reports it experienced an internal error."},
    "2153394082": {code: "SSL_ERROR_ACCESS_DENIED_ALERT", desc: "Peer received a valid certificate, but access was denied."},
    "2153394089": {code: "SSL_ERROR_BAD_HANDSHAKE_HASH_VALUE", desc: "Received incorrect handshakes hash values from peer."},
    "2153394104": {code: "SSL_ERROR_SOCKET_WRITE_FAILURE", desc: "Attempt to write encrypted data to underlying socket failed."},
    "2153394138": {code: "SSL_ERROR_RX_MALFORMED_ALERT", desc: "SSL received a malformed Alert record."},
    "2153394145": {code: "SSL_ERROR_RX_MALFORMED_SERVER_KEY_EXCH", desc: "SSL received a malformed Server Key Exchange handshake message."},
    "2153394151": {code: "SSL_ERROR_RX_RECORD_TOO_LONG", desc: "SSL received a record that exceeded the maximum permissible length."},
    "2153394158": {code: "SSL_ERROR_REVOKED_CERT_ALERT", desc: "SSL peer rejected your certificate as revoked."},
    "2153394159": {code: "SSL_ERROR_BAD_CERT_ALERT", desc: "SSL peer cannot verify your certificate."},
    "2153394161": {code: "SSL_ERROR_BAD_MAC_READ", desc: "SSL received a record with an incorrect Message Authentication Code."},
    "2153394164": {code: "SSL_ERROR_BAD_CERT_DOMAIN", desc: "Unable to communicate securely with peer: requested domain name does not match the server's certificate."},
    "2153394167": {code: "SSL_ERROR_UNSUPPORTED_VERSION", desc: "Peer using unsupported version of security protocol."},
    "2153394174": {code: "SSL_ERROR_NO_CYPHER_OVERLAP", desc: "Cannot communicate securely with peer: no common encryption algorithm(s)."},
    "2153398266": {code: "Unknown Security Failure", desc: "unknown"},
    "2153398267": {code: "Unknown Security Failure", desc: "unknown"},
    "2153398270": {code: "Unknown Security Failure", desc: "unknown"},
    "2153398271": {code: "Unknown Security Failure", desc: "unknown"},
    "3253927937": {code: "NS_ERROR_NOT_INITIALIZED", desc: "Component not initialized."}};

  const downloadCodeGeneralDetails = {
    "0": {code: "DWNLD_SUCCESS", desc: "The download succeeded."},
    "1": {code: "DWNLD_RETRY_OFFLINE", desc: "The went offline and the download will be retried when the network is online."},
    "2": {code: "DWNLD_RETRY_NET_TIMEOUT", desc: "The network timed out and the download will be retried."},
    "3": {code: "DWNLD_RETRY_CONNECTION_REFUSED", desc: "The connection to the download server was refused and the download will be retried."},
    "4": {code: "DWNLD_RETRY_NET_RESET", desc: "The network was reset and the download will be retried."},
    "5": {code: "DWNLD_ERR_NO_UPDATE", desc: "The local update metadata doesn't contain an update to download."},
    "6": {code: "DWNLD_ERR_NO_UPDATE_PATCH", desc: "The local update metadata doesn't contain an update patch to download."},
    "7": {code: "DWNLD_ERR_NO_PATCH_FILE", desc: "The update file that was being downloaded no longer exists."},
    "8": {code: "DWNLD_ERR_PATCH_SIZE_LARGER", desc: "The size of the update file being downloaded is larger than the size reported by the server."},
    "9": {code: "DWNLD_ERR_PATCH_SIZE_NOT_EQUAL", desc: "The size of the update file being downloaded does not equal the expected size."},
    "10": {code: "DWNLD_ERR_BINDING_ABORTED", desc: "The download request was aborted with NS_BINDING_ABORTED."},
    "11": {code: "DWNLD_ERR_ABORT", desc: "The download request was aborted with NS_ERROR_ABORT."},
    "12": {code: "DWNLD_ERR_DOCUMENT_NOT_CACHED", desc: "The download request was aborted with NS_ERROR_DOCUMENT_NOT_CACHED and the download will be retried as of Firefox 49 and greater (<a href='https://bugzilla.mozilla.org/show_bug.cgi?id=1272585'>Bug 1272585</a>)."},
    "13": {code: "DWNLD_ERR_VERIFY_NO_REQUEST", desc: "The download network request object no longer exists."},
    "14": {code: "DWNLD_ERR_VERIFY_PATCH_SIZE_NOT_EQUAL", desc: "The size of the downloaded update file does not equal the expected size."},
    "15": {code: "DWNLD_ERR_VERIFY_NO_HASH_MATCH", desc: "The file hash does not equal the hash specified in the update xml file."}};

  const stateCodeGeneralDetails = {
    "0": {code: "INVALID ERROR CODE", desc: "The update status file doesn't exist."},
    "1": {code: "STATE PRESENT BUT INVALID", desc: "The update status file existed but contained an invalid status."},
    "2": {code: "STATE_NONE", desc: "The update status file contained a null status."},
    "3": {code: "STATE_DOWNLOADING", desc: "The update is downloading (should be startup only)."},
    "4": {code: "STATE_PENDING", desc: "The update is ready to be applied (typically stage only)."},
    "5": {code: "STATE_PENDING_SVC", desc: "The update is ready to be applied by the service."},
    "6": {code: "STATE_APPLYING", desc: "The update is in the applying state."},
    "7": {code: "STATE_APPLIED", desc: "The update is in the applied state (should be stage only)."},
    "8": {code: "STATE_APPLIED_OS", desc: "The update is in the applied by the OS state (should be B2G and stage only)."},
    "9": {code: "STATE_APPLIED_SVC", desc: "The update is in the applied by the service state (should be startup only)."},
    "10": {code: "STATE_SUCCEEDED", desc: "The update was successfully applied (should be startup only)."},
    "11": {code: "STATE_DOWNLOAD_FAILED", desc: "The update download failed (should be startup only)."},
    "12": {code: "STATE_FAILED", desc: "The update failed to apply."}};

  const stateFailureCodeGeneralDetails = {
    "0": {code: "INVALID ERROR CODE", desc: "0 is a success code and should not be reported on failure."},
    "1": {code: "MAR_ERROR_EMPTY_ACTION_LIST", desc: "The mar file contained a manifest without any actions."},
    "2": {code: "LOADSOURCE_ERROR_WRONG_SIZE", desc: "The file to be patched is not the expected size."},
    "3": {code: "USAGE_ERROR", desc: "The command line is incorrect."},
    "4": {code: "CRC_ERROR", desc: "The file to be patched failed the CRC check."},
    "5": {code: "PARSE_ERROR", desc: "The manifest contained an invalid entry."},
    "6": {code: "READ_ERROR", desc: "Unable to read a file while updating."},
    "7": {code: "WRITE_ERROR", desc: "Unable to write to a file while updating."},
    "8": {code: "UNEXPECTED_ERROR", desc: "Replaced with errors 38-42"},
    "9": {code: "ELEVATION_CANCELED", desc: "The client cancelled the UAC elevation request to perform the update."},
    "10": {code: "READ_STRINGS_MEM_ERROR", desc: "Memory error while trying to read the updater.ini or update-settings.ini files."},
    "11": {code: "ARCHIVE_READER_MEM_ERROR", desc: "Memory error while trying to read the mar file."},
    "12": {code: "BSPATCH_MEM_ERROR", desc: "Memory error while trying to apply a patch file."},
    "13": {code: "UPDATER_MEM_ERROR", desc: "Memory error while updating."},
    "14": {code: "UPDATER_QUOTED_PATH_MEM_ERROR", desc: "Memory error while getting a quoted path."},
    "15": {code: "BAD_ACTION_ERROR", desc: "The update manifest contained a valid token without an action."},
    "16": {code: "STRING_CONVERSION_ERROR", desc: "Error converting a wide char to a utf8 char (Windows only)."},
    "17": {code: "CERT_LOAD_ERROR", desc: "The certificate couldnot be loaded (no longer used)."},
    "18": {code: "CERT_HANDLING_ERROR", desc: "Error while working with the certificate (no longer used)"},
    "19": {code: "CERT_VERIFY_ERROR", desc: "The signed mar file could not be verified."},
    "20": {code: "ARCHIVE_NOT_OPEN", desc: "The mar file was not open when it should have been open."},
    "21": {code: "COULD_NOT_READ_PRODUCT_INFO_BLOCK_ERROR", desc: "The mar file product information block could not be read."},
    "22": {code: "MAR_CHANNEL_MISMATCH_ERROR", desc: "The channel specified in the mar file was different than the installation's channel."},
    "23": {code: "VERSION_DOWNGRADE_ERROR", desc: "The version specified in the mar file was less than the installation's version."},
    "24": {code: "SERVICE_UPDATER_COULD_NOT_BE_STARTED", desc: "The service was unable to launch the updater (Windows only)."},
    "25": {code: "SERVICE_NOT_ENOUGH_COMMAND_LINE_ARGS", desc: "Not enough command line arguments were passed to the maintenance service (Windows only)."},
    "26": {code: "SERVICE_UPDATER_SIGN_ERROR", desc: "The signed binary could not be verified by the maintenance service (Windows only)."},
    "27": {code: "SERVICE_UPDATER_COMPARE_ERROR", desc: "The updater to be used by maintenance service is different than the installation's updater (Windows only)."},
    "28": {code: "SERVICE_UPDATER_IDENTITY_ERROR", desc: "The updater doesn't contain the updater identity string (Windows only)."},
    "29": {code: "SERVICE_STILL_APPLYING_ON_SUCCESS", desc: "The update is still in the applying state and the updater process returned a success code (Windows only)."},
    "30": {code: "SERVICE_STILL_APPLYING_ON_FAILURE", desc: "The update is still in the applying state and the updater process returned a failure code (Windows only)."},
    "31": {code: "SERVICE_UPDATER_NOT_FIXED_DRIVE", desc: "The path to the update is not local (Windows only)."},
    "32": {code: "SERVICE_COULD_NOT_LOCK_UPDATER", desc: "Unable to set no write sharing access on the updater (Windows only)."},
    "33": {code: "SERVICE_INSTALLDIR_ERROR", desc: "The maintenance service was unable to get the installation directory (Windows only)."},
    "34": {code: "NO_INSTALLDIR_ERROR", desc: "Unable to get the long path to the installation directory (Windows only)."},
    "35": {code: "WRITE_ERROR_ACCESS_DENIED", desc: "Unable to exclusively lock the callback executable with access denied error (Windows only)."},
    "36": {code: "WRITE_ERROR_SHARING_VIOLATION", desc: "Replaced with errors 46-48"},
    "37": {code: "WRITE_ERROR_CALLBACK_APP", desc: "Unable to exclusively lock the callback executable (Windows only)."},
    "39": {code: "UNEXPECTED_BZIP_ERROR", desc: "An unexpected decompression error occured."},
    "40": {code: "UNEXPECTED_MAR_ERROR", desc: "An unexpected mar error occured."},
    "41": {code: "UNEXPECTED_BSPATCH_ERROR", desc: "An unexpected patching error occured."},
    "42": {code: "UNEXPECTED_FILE_OPERATION_ERROR", desc: "An unexpected file operation error occured"},
    "43": {code: "FILESYSTEM_MOUNT_READWRITE_ERROR", desc: "An unexpected filesystem mount as read and write error occured (B2G only)"},
    "46": {code: "DELETE_ERROR_EXPECTED_DIR", desc: "When attempting to delete a directory a file was found."},
    "47": {code: "DELETE_ERROR_EXPECTED_FILE", desc: "When attempting to delete a file a directory was found."},
    "48": {code: "RENAME_ERROR_EXPECTED_FILE", desc:  "When attempting to rename a file a directory was found."},
    "49": {code: "SERVICE_COULD_NOT_COPY_UPDATER", desc: "Unable to copy the updater to a secure location (Windows only)."},
    "50": {code: "SERVICE_STILL_APPLYING_TERMINATED", desc: "The update is still in the applying state and the updater process was terminated (Windows only)."},
    "51": {code: "SERVICE_STILL_APPLYING_NO_EXIT_CODE", desc: "The update is still in the applying state and the updater process did not return an exit code (Windows only)."},
    "61": {code: "WRITE_ERROR_FILE_COPY", desc: "Error copying a file."},
    "62": {code: "WRITE_ERROR_DELETE_FILE", desc: "Error deleting a file."},
    "63": {code: "WRITE_ERROR_OPEN_PATCH_FILE", desc: "Unable to create new file for patching."},
    "64": {code: "WRITE_ERROR_PATCH_FILE", desc: "Error writing to patch file."},
    "65": {code: "WRITE_ERROR_APPLY_DIR_PATH", desc: "The directory to apply the update to was not found."},
    "66": {code: "WRITE_ERROR_CALLBACK_PATH", desc: "Unable to find the callback file at the path specified (Windows only)."},
    "67": {code: "WRITE_ERROR_FILE_ACCESS_DENIED", desc: "Access denied when checking file write access."},
    "68": {code: "WRITE_ERROR_DIR_ACCESS_DENIED", desc: "Access denied when checking directory write access"},
    "69": {code: "WRITE_ERROR_DELETE_BACKUP", desc: "Error deleting backup file."},
    "70": {code: "WRITE_ERROR_EXTRACT", desc: "Error writing to a file when extracting it from the mar file."},
    "71": {code: "REMOVE_FILE_SPEC_ERROR", desc: "Error removing the trailing file name and backslash from a path (Windows only)."},
    "72": {code: "INVALID_APPLYTO_DIR_STAGED_ERROR", desc: "The directory to apply the update to is not the same as or a child of the installation directory."},
    "73": {code: "LOCK_ERROR_PATCH_FILE", desc: "Error locking a patch file (Windows only)."},
    "74": {code: "INVALID_APPLYTO_DIR_ERROR", desc: "Installation directory and working directory were not the same for a non-staged update (Windows only)."},
    "80": {code: "FOTA_GENERAL_ERROR", desc: "General error from the recovery service (B2G only)."},
    "81": {code: "FOTA_UNKNOWN_ERROR", desc: "Unexpected error from the recovery service (B2G only)."},
    "82": {code: "FOTA_FILE_OPERATION_ERROR", desc: "File operation error (B2G only)"},
    "83": {code: "FOTA_RECOVERY_ERROR", desc: "Error initializing the receovery service (B2G only)"},
    "84": {code: "INVALID_UPDATER_STATE_CODE", desc: "Invalid update state code."},
    "99": {code: "INVALID_UPDATER_STATUS_CODE", desc: "Invalid update state failed code."},
    "100": {code: "Invalid code", desc: "Unknown"}};

  const checkCodeGood = [1, 2, 3, 4, 6, 7, 8, 9, 10, 11];
  const checkCodeBad = [0, 5, 14, 15, 18, 19, 20, 21, 22, 23, 24, 25, 27, 29, 30, 31, 32, 33, 34, 35, 36];

  var checkCodeBarClassFn = function(d) {
    if (checkCodeBad.indexOf(d.index) > -1) {
      return "checkCode badBar";
    } else if (checkCodeGood.indexOf(d.index) > -1) {
      return "checkCode goodBar";
    } else {
      return "checkCode okBar";
    }};

  var checkCodeX = d3.scale.ordinal()
    .rangeRoundBands([0, bcWidth], .1, .1);

  var checkCodeY = d3.scale.linear()
    .range([bcHeight, 0]);

  var checkCodeXAxis = d3.svg.axis()
    .scale(checkCodeX)
    .orient("bottom");

  var checkCodeYAxis = d3.svg.axis()
    .scale(checkCodeY)
    .orient("left")
    .tickFormat(formatPercent);

  // checkCodeSVG is not used besides here
  var checkCodeSVG = d3.select("#checkCodeChart")
    .attr("width", bcWidth + bcMargin.left + bcMargin.right)
    .attr("height", bcHeight + bcMargin.top + bcMargin.bottom)
    .append("g")
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")");

  checkCodeSVG.append("g")
    .attr("class", "x axis checkCodeAxis")
    .attr("transform", "translate(0," + bcHeight + ")");

  checkCodeSVG.append("g")
    .attr("class", "y axis checkCodeAxis");

  const checkExErrorDetails = {
    "-1": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_CHECK_EXTENDED_ERROR_NOTIFY keyed " +
                                  "histogram for this Firefox version but has one for a different Firefox version."},
    "-2": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_CHECK_EXTENDED_ERROR_NOTIFY keyed " +
                                  "histogram for any Firefox version."}};
  const checkExErrorGood = [];
  const checkExErrorOK = [];

  var checkExErrorBarClassFn = function(d) {
    if (checkExErrorOK.indexOf(d.index) > -1) {
      return "checkExError okBar";
    } else if (checkExErrorGood.indexOf(d.index) > -1) {
      return "checkExError goodBar";
    } else {
      return "checkExError badBar";
    }};

  var checkExErrorX = d3.scale.ordinal()
    .rangeRoundBands([0, bcWidth], .1, .1);

  var checkExErrorY = d3.scale.linear()
    .range([bcHeight, 0]);

  var checkExErrorXAxis = d3.svg.axis()
    .scale(checkExErrorX)
    .orient("bottom");

  var checkExErrorYAxis = d3.svg.axis()
    .scale(checkExErrorY)
    .orient("left")
    .tickFormat(formatPercent);

  // checkExErrorSVG is not used besides here
  var checkExErrorSVG = d3.select("#checkExErrorChart")
    .attr("width", bcWidth + bcMargin.left + bcMargin.right)
    .attr("height", bcHeight + bcMargin.top + bcMargin.bottom + bottomOffset)
    .append("g")
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")");

  checkExErrorSVG.append("g")
    .attr("class", "x axis checkExErrorAxis")
    .attr("transform", "translate(0," + bcHeight + ")");

  checkExErrorSVG.append("g")
    .attr("class", "y axis checkExErrorAxis");

  const downloadCodeDetails = {
    "-1": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_DOWNLOAD_CODE_COMPLETE or UPDATE_DOWNLOAD_CODE_PARTIAL " +
                                  "histograms for this Firefox version but has one for a different Firefox version."},
    "-2": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_DOWNLOAD_CODE_COMPLETE or UPDATE_DOWNLOAD_CODE_PARTIAL " +
                                  "histograms for any Firefox version. Some of these are clients that updated from a Firefox version without telemetry."}};
  const downloadCodeGood = [0];
  const downloadCodeBad = [-2, -1, 5, 6, 7, 8, 9, 10, 11, 13, 14, 15];

  var downloadCodeBarClassFn = function(d) {
    if (downloadCodeBad.indexOf(d.index) > -1) {
      return "downloadCode badBar";
    } else if (downloadCodeGood.indexOf(d.index) > -1) {
      return "downloadCode goodBar";
    } else {
      return "downloadCode okBar";
    }};

  var downloadCodeX = d3.scale.ordinal()
    .rangeRoundBands([0, bcWidth], .1, .1);

  var downloadCodeY = d3.scale.linear()
    .range([bcHeight, 0]);

  var downloadCodeXAxis = d3.svg.axis()
    .scale(downloadCodeX)
    .orient("bottom");

  var downloadCodeYAxis = d3.svg.axis()
    .scale(downloadCodeY)
    .orient("left")
    .tickFormat(formatPercent);

  // downloadCodeSVG is not used besides here
  var downloadCodeSVG = d3.select("#downloadCodeChart")
    .attr("width", bcWidth + bcMargin.left + bcMargin.right)
    .attr("height", bcHeight + bcMargin.top + bcMargin.bottom)
    .append("g")
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")");

  downloadCodeSVG.append("g")
    .attr("class", "x axis downloadCodeAxis")
    .attr("transform", "translate(0," + bcHeight + ")");

  downloadCodeSVG.append("g")
    .attr("class", "y axis downloadCodeAxis");

  const stateCodeStageDetails = {
    "-1": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_STATE_CODE_PARTIAL_STAGE or UPDATE_STATE_CODE_COMPLETE_STAGE histograms for this Firefox version " +
                                  "but has one for a different Firefox version. Staging is optional and some of these are clients that updated from a Firefox version without telemetry."},
    "-2": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_STATE_CODE_PARTIAL_STAGE or UPDATE_STATE_CODE_COMPLETE_STAGE histograms for any Firefox " +
                                  "version. Staging is optional and some of these are clients that updated from a Firefox version without telemetry."}};
  const stateCodeStageGood = [3, 4, 5, 7, 9, 10];
  const stateCodeStageBad = [-2, 0, 1, 2, 6, 8, 11, 12];

  var stateCodeStageBarClassFn = function(d) {
    if (stateCodeStageBad.indexOf(d.index) > -1) {
      return "stateCodeStage badBar";
    } else if (stateCodeStageGood.indexOf(d.index) > -1) {
      return "stateCodeStage goodBar";
    } else {
      return "stateCodeStage okBar";
    }};

  var stateCodeStageX = d3.scale.ordinal()
    .rangeRoundBands([0, bcWidth], .1, .1);

  var stateCodeStageY = d3.scale.linear()
    .range([bcHeight, 0]);

  var stateCodeStageXAxis = d3.svg.axis()
    .scale(stateCodeStageX)
    .orient("bottom");

  var stateCodeStageYAxis = d3.svg.axis()
    .scale(stateCodeStageY)
    .orient("left")
    .tickFormat(formatPercent);

  // stateCodeStageSVG is not used besides here
  var stateCodeStageSVG = d3.select("#stateCodeStageChart")
    .attr("width", bcWidth + bcMargin.left + bcMargin.right)
    .attr("height", bcHeight + bcMargin.top + bcMargin.bottom)
    .append("g")
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")");

  stateCodeStageSVG.append("g")
    .attr("class", "x axis stateCodeStageAxis")
    .attr("transform", "translate(0," + bcHeight + ")");

  stateCodeStageSVG.append("g")
    .attr("class", "y axis stateCodeStageAxis");

  const stateFailureCodeStageGood = [];
  const stateFailureCodeStageOK = [];

  var stateFailureCodeStageBarClassFn = function(d) {
    if (stateFailureCodeStageOK.indexOf(d.index) > -1) {
      return "stateFailureCodeStage okBar";
    } else if (stateFailureCodeStageGood.indexOf(d.index) > -1) {
      return "stateFailureCodeStage goodBar";
    } else {
      return "stateFailureCodeStage badBar";
    }};

  var stateFailureCodeStageX = d3.scale.ordinal()
    .rangeRoundBands([0, bcWidth], .1, .1);

  var stateFailureCodeStageY = d3.scale.linear()
    .range([bcHeight, 0]);

  var stateFailureCodeStageXAxis = d3.svg.axis()
    .scale(stateFailureCodeStageX)
    .orient("bottom");

  var stateFailureCodeStageYAxis = d3.svg.axis()
    .scale(stateFailureCodeStageY)
    .orient("left")
    .tickFormat(formatPercent);

  // stateFailureCodeStageSVG is not used besides here
  var stateFailureCodeStageSVG = d3.select("#stateFailureCodeStageChart")
    .attr("width", bcWidth + bcMargin.left + bcMargin.right)
    .attr("height", bcHeight + bcMargin.top + bcMargin.bottom)
    .append("g")
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")");

  stateFailureCodeStageSVG.append("g")
    .attr("class", "x axis stateFailureCodeStageAxis")
    .attr("transform", "translate(0," + bcHeight + ")");

  stateFailureCodeStageSVG.append("g")
    .attr("class", "y axis stateFailureCodeStageAxis");

  const stateCodeStartupDetails = {
    "-1": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_STATE_CODE_PARTIAL_STARTUP or UPDATE_STATE_CODE_COMPLETE_STARTUP " +
                                  "histograms for this Firefox version but has one for a different Firefox version."},
    "-2": {code: "NO PING", desc: "Telemetry did not contain a value for the UPDATE_STATE_CODE_PARTIAL_STARTUP or UPDATE_STATE_CODE_COMPLETE_STARTUP " +
                                  "histograms for any Firefox version. Some of these are clients that updated from a Firefox version without telemetry."}};
  const stateCodeStartupGood = [3, 4, 5, 10];
  const stateCodeStartupBad = [-2, 0, 1, 2, 6, 11, 12];

  var stateCodeStartupBarClassFn = function(d) {
    if (stateCodeStartupBad.indexOf(d.index) > -1) {
      return "stateCodeStartup badBar";
    } else if (stateCodeStartupGood.indexOf(d.index) > -1) {
      return "stateCodeStartup goodBar";
    } else {
      return "stateCodeStartup okBar";
    }};

  var stateCodeStartupX = d3.scale.ordinal()
    .rangeRoundBands([0, bcWidth], .1, .1);

  var stateCodeStartupY = d3.scale.linear()
    .range([bcHeight, 0]);

  var stateCodeStartupXAxis = d3.svg.axis()
    .scale(stateCodeStartupX)
    .orient("bottom");

  var stateCodeStartupYAxis = d3.svg.axis()
    .scale(stateCodeStartupY)
    .orient("left")
    .tickFormat(formatPercent);

  // stateCodeStartupSVG is not used besides here
  var stateCodeStartupSVG = d3.select("#stateCodeStartupChart")
    .attr("width", bcWidth + bcMargin.left + bcMargin.right)
    .attr("height", bcHeight + bcMargin.top + bcMargin.bottom)
    .append("g")
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")");

  stateCodeStartupSVG.append("g")
    .attr("class", "x axis stateCodeStartupAxis")
    .attr("transform", "translate(0," + bcHeight + ")");

  stateCodeStartupSVG.append("g")
    .attr("class", "y axis stateCodeStartupAxis");

  const stateFailureCodeStartupGood = [];
  const stateFailureCodeStartupOK = [9];

  var stateFailureCodeStartupBarClassFn = function(d) {
    if (stateFailureCodeStartupOK.indexOf(d.index) > -1) {
      return "stateFailureCodeStartup okBar";
    } else if (stateFailureCodeStartupGood.indexOf(d.index) > -1) {
      return "stateFailureCodeStartup goodBar";
    } else {
      return "stateFailureCodeStartup badBar";
    }};

  var stateFailureCodeStartupX = d3.scale.ordinal()
    .rangeRoundBands([0, bcWidth], .1, .1);

  var stateFailureCodeStartupY = d3.scale.linear()
    .range([bcHeight, 0]);

  var stateFailureCodeStartupXAxis = d3.svg.axis()
    .scale(stateFailureCodeStartupX)
    .orient("bottom");

  var stateFailureCodeStartupYAxis = d3.svg.axis()
    .scale(stateFailureCodeStartupY)
    .orient("left")
    .tickFormat(formatPercent);

  // stateFailureCodeStartupSVG is not used besides here
  var stateFailureCodeStartupSVG = d3.select("#stateFailureCodeStartupChart")
    .attr("width", bcWidth + bcMargin.left + bcMargin.right)
    .attr("height", bcHeight + bcMargin.top + bcMargin.bottom)
    .append("g")
      .attr("transform", "translate(" + bcMargin.left + "," + bcMargin.top + ")");

  stateFailureCodeStartupSVG.append("g")
    .attr("class", "x axis stateFailureCodeStartupAxis")
    .attr("transform", "translate(0," + bcHeight + ")");

  stateFailureCodeStartupSVG.append("g")
    .attr("class", "y axis stateFailureCodeStartupAxis");

  // Reset checkboxes to checked since a refresh will keep the previous state.
  var sortCheckboxes = document.getElementsByClassName("sortCheckbox");
  for (i = 0; i < sortCheckboxes.length; i++) {
    sortCheckboxes[i].checked = true;
  }

  var startDate = new Date();
  startDate.setDate(23);
  startDate.setMonth(9);
  startDate.setFullYear(2016);

  // Resets tables and divs so they can be populated or repopulated with the data file.
  function clearContent() {
    var i;
    var pieCharts = document.getElementsByClassName("pieChart");
    for(i = 0; i < pieCharts.length; i++) {
      pieCharts[i].innerHTML = "";
    }

    var barChartDescs = document.getElementsByClassName("barChartDesc");
    for(i = 0; i < barChartDescs.length; i++) {
      barChartDescs[i].innerHTML = "Hover over a bar above to display details.";
    }

    var barChartLinks = document.getElementsByClassName("barChartLink");
    for(i = 0; i < barChartLinks.length; i++) {
      barChartLinks[i].innerHTML = "";
    }
  }

  function getMonthDateYear(aDate) {
    var year = aDate.getFullYear();
    var month = aDate.getMonth() + 1;
    if (month < 10) {
      month = "0" + month;
    }
    var day = aDate.getDate();
    if (day < 10) {
      day = "0" + day;
    }
    return [year, month, day];
  }

  function xhrHandler() {
    if (this.status != 404) {
      finishDataFileCheck();
      populateDashboard();
    } else {
      reportDate.setDate(reportDate.getDate() - 7);
      // Prevent an infinite loop
      if (reportDate >= startDate) {
        [year, month, day] = getMonthDateYear(reportDate);
        reportFile = [year, month, day, ".json"].join("");
        urlExists(dataUrl + reportFile);
      } else {
        clearContent();
        document.getElementById("summaryDistChart").innerHTML = "<strong>No data files found at the following location!</strong><br>(URL: <a href='" + dataUrl + "'>" + dataUrl + "</a>)";
      }
    }
  }

  function urlExists(aURL) {
    var xhr = new XMLHttpRequest();
    xhr.onload = xhrHandler;
    xhr.open('HEAD', aURL, true);
    xhr.send();
  }

  var today = new Date();
  var dayIndex = (today.getDay()) % 7;
  var dateOffset = (24 * 60 * 60 * 1000) * dayIndex;
  var reportDate = new Date();
  reportDate.setTime(today.getTime() - dateOffset);
  var [year, month, day] = getMonthDateYear(reportDate);
  var reportFile = [year, month, day, ".json"].join("");
  urlExists(dataUrl + reportFile);

  function finishDataFileCheck() {
    var tempReportDate = reportDate;
    var dateDropdown = document.getElementById("weeklyDropdown");
    dateDropdown.innerHTML = "";
    while (tempReportDate >= startDate) {
      var [tempYear, tempMonth, tempDay] = getMonthDateYear(tempReportDate);
      dateDropdown.innerHTML += "<option value=\"" + tempYear + tempMonth + tempDay + ".json\">" +
                                tempMonth + "/" + tempDay + "/" + tempYear + "</option>";
      tempReportDate.setDate(tempReportDate.getDate() - 7);
    }
    var currentlySelectedDataFile = reportFile;
  }

  function updateDetailsRow(aTableID, aRowNum, aSubset, aTotal, aTitle, aDesc) {
    var row;
    var table = document.getElementById(aTableID);
    if (table.rows.length <= aRowNum) {
      row = table.insertRow(aRowNum);
      row.insertCell(0);
      row.insertCell(1);
      row.insertCell(2);
    }

    var percent = "N/A";
    var subset = "(N/A)";
    var notIncludedDesc = " <i>(not included in this dataset)</i>";
    if (aSubset) {
      notIncludedDesc = "";
      if (aTotal) {
        percent = ((100 / aTotal * aSubset).toFixed(1)).toLocaleString("en-US") + "%";
      }
      subset = "(" + aSubset.toLocaleString("en-US") +")";
    }

    row = table.rows[aRowNum];
    row.cells[0].innerHTML = percent;
    row.cells[1].innerHTML = subset;
    row.cells[2].innerHTML = "<b>" + aTitle + "</b>"  + notIncludedDesc + ": " + aDesc;
  }

  function displayBarDetails(aPrefixID, aIndex, aChartData, aJSONData, aDetails1, aDetails2, aSrchOpt) {
    var percentage = 0;
    for (var i = 0; i < aChartData.length; ++i) {
      if (aChartData[i].index == aIndex) {
        percentage = aChartData[i].value * 100;
        break;
      }
    }
    var total = aJSONData[aIndex] ? aJSONData[aIndex] : 0;
    percentage = percentage.toFixed(1);
    var oDetails;
    if (aDetails1 && aDetails1[aIndex]) {
      oDetails = aDetails1[aIndex];
    } else if (aDetails2 && aDetails2[aIndex]) {
      oDetails = aDetails2[aIndex];
    }
    var detailsText = "<b>" + percentage + "% (" + total + ") " + aIndex;
    var linkText = "";
    if (oDetails) {
      detailsText = detailsText + " " + oDetails.code + "</b>: " + oDetails.desc;
      linkText = getSearchLink(oDetails.code, aSrchOpt);
    } else {
      detailsText = detailsText + " Unknown</b>: Unknown";
    }
    document.getElementById(aPrefixID + "Link").innerHTML = linkText;
    document.getElementById(aPrefixID + "Details").innerHTML = detailsText;
  }

  function getSearchLink(aSearchString, aSrchOpt) {
    if (aSrchOpt === null || !aSearchString || aSearchString == "STATE PRESENT BUT INVALID" ||
        aSearchString == "INVALID ERROR CODE" || aSearchString == "NO PING") {
      return "";
    }
    var text = "Search dxr.mozilla.org for "
    var searchString = 'regexp:"( |\\(|\\.|,)' + aSearchString + '( |;|\\)|,)"';
    var path = "+path%3Atoolkit%2F";
    var ext = "";
    if (aSrchOpt) {
      path = path + "mozapps%2Fupdate%2FnsUpdateService.js"; // Only nsUpdateService.js
    } else {
      ext = "+ext%3Acpp";
    }
    return "<a target='_blank' href='https://dxr.mozilla.org/mozilla-esr45/search?q=" +
           searchString + path + ext + "&redirect=false'>" + text + aSearchString + "</a>";
  }

  function populateDashboard(event) {
    var dataFile = null;
    if (event && event.type == "load") {
      dataFile = reportFile;
    } else {
      dataFile = document.getElementById("weeklyDropdown").value;
    }

    clearContent();

    function getJSONValue(aData, aName, aKey, aDefault) {
      var result = aDefault;
      try {
        result = aData[aName][aKey];
      } catch (e) {
      }
      return result;
    }
    $.getJSON(dataUrl + dataFile, {}, function(data) {
      var first = true;

      // Display a d3pie chart.
      // @param aDivId: a div id to populate with the d3pie
      // @param aTitle: a title for the d3pie
      // @param aDescription: a description for the d3pie
      // @param aSlices: an array of d3pie slices to populate the pie chart with
      function displayD3Pie(aDivId, aTitle, aSlices, aSortOrder) {
        new d3pie(aDivId, {
          "header": {
            "title": {
              "text": aTitle,
              "fontSize": 20,
              "font": "Arial"
            },
            "subtitle": {
              "text": "(hover over a pie chart slice for more details)",
              "color": "#999999",
              "fontSize": 14,
              "font": "Arial"
            },
            "titleSubtitlePadding": 9
          },
          "footer": {
            "color": "#999999",
            "fontSize": 10,
            "font": "open sans",
            "location": "bottom-left"
          },
          "size": {
            "canvasWidth": 960,
            "pieOuterRadius": "90%"
          },
          "data": {
            "sortOrder": aSortOrder,
            "content": aSlices
          },
          "labels": {
            "outer": {
              "hideWhenLessThanPercentage": 0,
              "pieDistance": 32
            },
            "inner": {
              "hideWhenLessThanPercentage": 3
            },
            "mainLabel": {
              "fontSize": 11
            },
            "percentage": {
              "color": "#ffffff",
              "decimalPlaces": 1
            },
            "value": {
              "color": "#adadad",
              "fontSize": 11
            },
            "lines": {
              "enabled": true,
              "style": "straight"
            },
            "truncation": {
              "enabled": true
            }
          },
          "effects": {
            "pullOutSegmentOnClick": {
              "effect": "linear",
              "speed": 400,
              "size": 8
            }
          },
          tooltips: {
            enabled: true,
            type: "placeholder",
            string: "{label}: {percentage}% ({value})",
            placeholderParser: function(index, data) {
              data.value = data.value.toLocaleString("en-US");
            }
          },
          "misc": {
            "gradient": {
              "enabled": true,
              "percentage": 100
            }
          }
        });
      }

      // Required values from the JSON
      var latestVersion = data["reportDetails"]["latestVersion"];
      var upToDateReleases = data["reportDetails"]["upToDateReleases"];
      var minUpdatePingCount = getJSONValue(data, "reportDetails", "minUpdatePingCount", 0);
      var weeksOfSubsessionData = getJSONValue(data, "reportDetails", "weeksOfSubsessionData", 0);
      var minSubsessionSeconds = getJSONValue(data, "reportDetails", "minSubsessionSeconds", 0);

      var seconds = minSubsessionSeconds;
      var hours = Math.floor(seconds / 3600);
      seconds %= 3600;
      var minutes = Math.floor(seconds / 60);
      var minRunLengthString = hours;
      if (minutes == 0) {
        minRunLengthString = minRunLengthString + " hours";
      } else {
        if (hours == 0) {
          minRunLengthString = minutes + " minutes";
        } else {
          minRunLengthString = minRunLengthString + ":";
          if (minutes.toString().length == 1) {
            minRunLengthString = minRunLengthString + "0";
          }
          minRunLengthString = minRunLengthString + minutes + " hours";
        }
      }

      // Required values from the JSON
      var versionUpToDate = data["summary"]["versionUpToDate"];
      var versionOutOfDate = data["summary"]["versionOutOfDate"];
      var ofConcernTrue = data["ofConcern"]["True"];

      var outOfDateExcludedTotal = versionOutOfDate - ofConcernTrue;
      var totalUpdateData = versionUpToDate + versionOutOfDate;

      // The values are not required in the JSON which allows the removal and
      // addition of new values.
      var hasOutOfDateMaxVersionFalse = getJSONValue(data, "hasOutOfDateMaxVersion", "False", 0);
      var hasUpdatePingFalse = getJSONValue(data, "hasUpdatePing", "False", 0);
      var hasMinSubsessionLengthFalse = getJSONValue(data, "hasMinSubsessionLength", "False", 0);
      var hasMinUpdatePingCountFalse = getJSONValue(data, "hasMinUpdatePingCount", "False", 0);
      var isSupportedFalse = getJSONValue(data, "isSupported", "False", 0);
      var isAbleToApplyFalse = getJSONValue(data, "isAbleToApply", "False", 0);
      var hasUpdateEnabledFalse = getJSONValue(data, "hasUpdateEnabled", "False", 0);

      var hasOnlyNoUpdateFoundTrue = getJSONValue(data, "hasOnlyNoUpdateFound", "True", 0);
      var hasNoDownloadCodeTrue = getJSONValue(data, "hasNoDownloadCode", "True", 0);
      var hasUpdateApplyFailureTrue = getJSONValue(data, "hasUpdateApplyFailure", "True", 0);
      var ofConcernCategorizedFalse = getJSONValue(data, "ofConcernCategorized", "False", 0);

      // Populate summary distribution and minimum requirements pie charts and detail tables
      var termLabel;
      var distributionSlices = [];
      termLabel = "Up to date";
      updateDetailsRow("summaryDistDetails", 0, versionUpToDate, totalUpdateData, termLabel,
                       "the client's Firefox version is " + (latestVersion - 2) + " or higher " +
                       "and less than " + (latestVersion + 1) + ".");
      if (versionUpToDate) {
        distributionSlices.push({"label": termLabel, "value": versionUpToDate, "color": "#0065D1"});
      }

      termLabel = "Out of date, potentially of concern";
      updateDetailsRow("summaryDistDetails", 1, outOfDateExcludedTotal, totalUpdateData, termLabel,
                       "the client does not meet the minimum requirements for there to be an " +
                       "expectation that the client should have updated (see chart below for details).");
      if (outOfDateExcludedTotal) {
        distributionSlices.push({"label": termLabel, "value": outOfDateExcludedTotal, "color": "#DBD100"});
      }

      termLabel = "Out of date, of concern";
      updateDetailsRow("summaryDistDetails", 2, ofConcernTrue, totalUpdateData, termLabel,
                       "the client meets the minimum requirements for there to be an " +
                       "expectation that the client should have updated.");
      if (ofConcernTrue) {
        distributionSlices.push({"label": termLabel, "value": ofConcernTrue, "color": "#D10000"});
      }

      displayD3Pie("summaryDistChart", "Up to date and out of date client distribution",
                   distributionSlices, null);

      var NotMinReqsSlices = [];
      termLabel = "Up to date version previously reported";
      updateDetailsRow("notMinReqsDetails", 0, hasOutOfDateMaxVersionFalse, outOfDateExcludedTotal, termLabel,
                       "the client has a previous telemetry ping for an up to date version. " +
                       "This can be caused by downgrading to an earlier version or using " +
                       "multiple installations with different versions with the same profile.");
      if (hasOutOfDateMaxVersionFalse) {
        NotMinReqsSlices.push({"label": termLabel, "value": hasOutOfDateMaxVersionFalse, "color": "#0065D1"});
      }

        termLabel = "No update pings";
        updateDetailsRow("notMinReqsDetails", 1, hasUpdatePingFalse, outOfDateExcludedTotal, termLabel,
                         "the client has never sent an update telemetry ping for any Firefox " +
                         "version. This can be caused by building without application update as " +
                         "Firefox distributions typically do.");
      if (hasUpdatePingFalse) {
        NotMinReqsSlices.push({"label": termLabel, "value": hasUpdatePingFalse, "color": "#004949"});
      }

      termLabel = "Ran for less than " + minRunLengthString;
      updateDetailsRow("notMinReqsDetails", 2, hasMinSubsessionLengthFalse, outOfDateExcludedTotal, termLabel,
                       "the client has not run Firefox for a minimum of " + minRunLengthString +
                       " total for all sessions using the same Firefox version over the " +
                       "previous " + weeksOfSubsessionData + " weeks (" +
                       (weeksOfSubsessionData * 7) + " days).");
      if (hasMinSubsessionLengthFalse) {
        NotMinReqsSlices.push({"label": termLabel, "value": hasMinSubsessionLengthFalse, "color": "#490092"});
      }

      termLabel = "Less than " + minUpdatePingCount + " update pings";
      updateDetailsRow("notMinReqsDetails", 3, hasMinUpdatePingCountFalse, outOfDateExcludedTotal, termLabel,
                       "the client has sent less than " + minUpdatePingCount + " update " +
                       "telemetry pings with the same Firefox version over the previous " +
                       weeksOfSubsessionData + " weeks. Since there is an update telemetry ping " +
                       "every 12 hours and it happens within minutes after startup when the 12 " +
                       "hours have elapsed this is equivalent to these clients only running " +
                       "Firefox on " + (minUpdatePingCount - 1) + " days or less during the "+
                       "previous " + (weeksOfSubsessionData * 7) + " days.");
      if (hasMinUpdatePingCountFalse) {
        NotMinReqsSlices.push({"label": termLabel, "value": hasMinUpdatePingCountFalse, "color": "#924900"});
      }

      termLabel = "Platform no longer supported";
      updateDetailsRow("notMinReqsDetails", 4, isSupportedFalse, outOfDateExcludedTotal, termLabel,
                       "the client's platform does not meet the minimum Firefox system " +
                       "requirements to update to a newer version.");
      if (isSupportedFalse) {
        NotMinReqsSlices.push({"label": termLabel, "value": isSupportedFalse, "color": "#FFB677"});
      }

      termLabel = "Unable to apply updates";
      updateDetailsRow("notMinReqsDetails", 5, isAbleToApplyFalse, outOfDateExcludedTotal, termLabel,
                       "the client does not have the required system permissions to be able to " +
                       "update. The client will still be notified that a newer Firefox version " +
                       "is available as long as Application Update is enabled.");
      if (isAbleToApplyFalse) {
        NotMinReqsSlices.push({"label": termLabel, "value": isAbleToApplyFalse, "color": "#009292"});
      }

      termLabel = "Updates disabled";
      updateDetailsRow("notMinReqsDetails", 6, hasUpdateEnabledFalse, outOfDateExcludedTotal, termLabel,
                       "the client has disabled Application Update.");
      if (hasUpdateEnabledFalse) {
        NotMinReqsSlices.push({"label": termLabel, "value": hasUpdateEnabledFalse, "color": "#B66DFF"});
      }

      displayD3Pie("notMinReqsChart", "Out of date, potentially of concern reason distribution",
                   NotMinReqsSlices, null);

      var ofConcernSlices = [];
      termLabel = "Uncategorized";
      updateDetailsRow("ofConcernDetails", 0, ofConcernCategorizedFalse, ofConcernTrue, termLabel,
                       "the client reason has not yet been categorized.");
      if (ofConcernCategorizedFalse) {
        ofConcernSlices.push({"label": termLabel, "value": ofConcernCategorizedFalse, "color": "#0065D1"});
      }

      termLabel = "No updates found";
      updateDetailsRow("ofConcernDetails", 1, hasOnlyNoUpdateFoundTrue, ofConcernTrue, termLabel,
                       "the client has only received no updates found when performing an " +
                       "update check using the same Firefox version. " +
                       "<a href='https://bugzilla.mozilla.org/show_bug.cgi?id=1224955'>Bug 1224955</a> " +
                       "provides an example of what can cause this.");
      if (hasOnlyNoUpdateFoundTrue) {
        ofConcernSlices.push({"label": termLabel, "value": hasOnlyNoUpdateFoundTrue, "color": "#004949"});
      }

      termLabel = "No download attempts";
      updateDetailsRow("ofConcernDetails", 2, hasNoDownloadCodeTrue, ofConcernTrue, termLabel,
                       "the client has made no download attempts using the same Firefox version.");
      if (hasNoDownloadCodeTrue) {
        ofConcernSlices.push({"label": termLabel, "value": hasNoDownloadCodeTrue, "color": "#490092"});
      }

      termLabel = "Update apply failure";
      updateDetailsRow("ofConcernDetails", 3, hasUpdateApplyFailureTrue, ofConcernTrue, termLabel,
                       "the client has one or more update apply failures using the same Firefox version.");
      if (hasUpdateApplyFailureTrue) {
        ofConcernSlices.push({"label": termLabel, "value": hasUpdateApplyFailureTrue, "color": "#924900"});
      }

      displayD3Pie("ofConcernChart", "Out of date, of concern reason distribution",
                   ofConcernSlices, null);

      var outOfDateDesc = document.getElementById("outOfDateDesc");
      outOfDateDesc.innerHTML = "Note: For this report, <b>out of date</b> refers to Firefox " +
                                "42 (first version with opt-out telemetry for 100% of the " +
                                "release population) through versions less than Firefox " +
                                (latestVersion - upToDateReleases) + " (" +
                                (upToDateReleases + 1) + " versions prior to the latest Firefox " +
                                "version at the time this data was generated).";

      var ofConcernByVersion = data["ofConcernByVersion"];
      if (ofConcernByVersion) {
        // Color-blind-friendly palette taken from:
        // http://mkweb.bcgsc.ca/biovis2012/
        var versionColors = ["#B66DFF",  // purple
                             "#92B600",  // green
                             "#B6DBFF",  // light blue
                             "#004949",  // dark green
                             "#490092",  // dark purple
                             "#924900",  // brown
                             "#009292",  // dark turquoise
                             "#FFB677",  // orange
                             "#006D6D",  // darker turquoise
                             "#6DB6FF",  // blue
                             "#DBD100",  // dark yellow
                             "#FF6DB6",  // pink
                             "#FFFF6D",  // yellow
                             "#24FF24",  // light green
                             "#000000"]; // black
        var versionSlices = [];
        for (var v in ofConcernByVersion) {
          var labelName = v;
          var diff = (latestVersion - labelName.split(".")[0]) - 3;
          var color = versionColors[Math.min(diff, versionColors.length - 1)];
          if (labelName == "43.0.1" || labelName == "47.0.2") {
            labelName = labelName + " (watershed)";
          }
          versionSlices.push({"label": labelName, "value": ofConcernByVersion[v],
                              "color": color});
        }
        displayD3Pie("VersionDistChart",
                     "Out of date, of concern client distribution across Firefox versions",
                     versionSlices, "label-asc");
      }

      var checkCodeNotifyOfConcern = data["checkCodeNotifyOfConcern"];
      var [checkCodeData, checkCodeTotal] = getBarData(checkCodeNotifyOfConcern);
      d3.select("#checkCodeSortInput").on("change", function() {
        barChartSortChange(checkCodeData, "checkCode", checkCodeX, checkCodeXAxis);
      });
      updateBarChart(checkCodeData, "checkCode", checkCodeBarClassFn, checkCodeX,
                     checkCodeY, checkCodeXAxis, checkCodeYAxis,
                     checkCodeNotifyOfConcern, checkCodeGeneralDetails, null, true);

      var checkExErrorNotifyOfConcern = data["checkExErrorNotifyOfConcern"];
      var [checkExErrorData, checkExErrorTotal] = getBarData(checkExErrorNotifyOfConcern);
      d3.select("#checkExErrorSortInput").on("change", function() {
        barChartSortChange(checkExErrorData, "checkExError", checkExErrorX, checkExErrorXAxis);
      });
      updateBarChart(checkExErrorData, "checkExError", checkExErrorBarClassFn, checkExErrorX,
                     checkExErrorY, checkExErrorXAxis, checkExErrorYAxis,
                     checkExErrorNotifyOfConcern, checkExErrorGeneralDetails, checkExErrorDetails, null);

      var downloadCodeOfConcern = data["downloadCodeOfConcern"]
      var [downloadCodeData, downloadCodeTotal] = getBarData(downloadCodeOfConcern);
      d3.select("#downloadCodeSortInput").on("change", function() {
        barChartSortChange(downloadCodeData, "downloadCode", downloadCodeX, downloadCodeXAxis);
      });
      updateBarChart(downloadCodeData, "downloadCode", downloadCodeBarClassFn, downloadCodeX,
                     downloadCodeY, downloadCodeXAxis, downloadCodeYAxis,
                     downloadCodeOfConcern, downloadCodeGeneralDetails, downloadCodeDetails, true);

      var stateCodeStageOfConcern = data["stateCodeStageOfConcern"];
      var [stateCodeStageData, stateCodeStageTotal] = getBarData(stateCodeStageOfConcern);
      d3.select("#stateCodeStageSortInput").on("change", function() {
        barChartSortChange(stateCodeStageData, "stateCodeStage", stateCodeStageX, stateCodeStageXAxis);
      });
      updateBarChart(stateCodeStageData, "stateCodeStage", stateCodeStageBarClassFn, stateCodeStageX,
                     stateCodeStageY, stateCodeStageXAxis, stateCodeStageYAxis,
                     stateCodeStageOfConcern, stateCodeGeneralDetails, stateCodeStageDetails, true);

      var stateFailureCodeStageOfConcern = data["stateFailureCodeStageOfConcern"];
      var [stateFailureCodeStageData, stateFailureCodeStageTotal] = getBarData(stateFailureCodeStageOfConcern);
      d3.select("#stateFailureCodeStageSortInput").on("change", function() {
        barChartSortChange(stateFailureCodeStageData, "stateFailureCodeStage", stateFailureCodeStageX, stateFailureCodeStageXAxis);
      });
      updateBarChart(stateFailureCodeStageData, "stateFailureCodeStage", stateFailureCodeStageBarClassFn, stateFailureCodeStageX,
                     stateFailureCodeStageY, stateFailureCodeStageXAxis, stateFailureCodeStageYAxis,
                     stateFailureCodeStageOfConcern, stateFailureCodeGeneralDetails, null, false);

      var stateCodeStartupOfConcern = data["stateCodeStartupOfConcern"];
      var [stateCodeStartupData, stateCodeStartupTotal] = getBarData(stateCodeStartupOfConcern);
      d3.select("#stateCodeStartupSortInput").on("change", function() {
        barChartSortChange(stateCodeStartupData, "stateCodeStartup", stateCodeStartupX, stateCodeStartupXAxis);
      });
      updateBarChart(stateCodeStartupData, "stateCodeStartup", stateCodeStartupBarClassFn, stateCodeStartupX,
                     stateCodeStartupY, stateCodeStartupXAxis, stateCodeStartupYAxis,
                     stateCodeStartupOfConcern, stateCodeGeneralDetails, stateCodeStartupDetails, true);

      var stateFailureCodeStartupOfConcern = data["stateFailureCodeStartupOfConcern"];
      var [stateFailureCodeStartupData, stateFailureCodeStartupTotal] = getBarData(stateFailureCodeStartupOfConcern);
      d3.select("#stateFailureCodeStartupSortInput").on("change", function() {
        barChartSortChange(stateFailureCodeStartupData, "stateFailureCodeStartup", stateFailureCodeStartupX, stateFailureCodeStartupXAxis);
      });
      updateBarChart(stateFailureCodeStartupData, "stateFailureCodeStartup", stateFailureCodeStartupBarClassFn, stateFailureCodeStartupX,
                     stateFailureCodeStartupY, stateFailureCodeStartupXAxis, stateFailureCodeStartupYAxis,
                     stateFailureCodeStartupOfConcern, stateFailureCodeGeneralDetails, null, false);
    }).fail(function() {
      document.getElementById("summaryDistChart").innerHTML = "<strong>No data files found at the following location!</strong><br>(URL: <a href='" +
                                                              dataUrl + reportFile + "'>" + dataUrl + reportFile + "</a>)";
    });
  }
</script>
</body>
</html>
